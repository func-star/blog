---
title: 作用域是干什么用的
date: 2018-06-26 19:49:12
tags:
---

在理解作用之前，我先介绍一下另外两个家伙---引擎和编译器。

* 引擎：负责javascript整个执行的过程
* 编译器：负责分词-解析词法-生成抽象语法树-生成可执行代码。javascript的代码片段编译发生在执行之前,大部分场景发生在代码执行前的几微秒。
* 作用域：总的来讲就是统一收集维护标识符变量，并管理访问权限

### 下面针对一个示例代码来讲述三者之间微妙的关系：
```js
var demo = 1;
```

实际上这段代码可以分解为两步，第一步是：var demo，第二步是demo = 1。
当引擎执行到这段代码时，编译器首先会对这段代码进行如下处理：

* 编译器会询问作用域是否已经存在一个叫demo的标识符（即变量）在同一个作用域中，若是，直接忽略这个声明，否则编译器会要求在当前作用域中声明一个叫demo的标识符，并分配存储内存。
* 在编译器生成完可执行的代码之后，引擎开始处理demo = 1这个命令。
   1. 首先引擎会询问当前作用域是否已经存在一个叫做demo的标识符（变量）。
   2. 如果存在，引擎开始使用这个变量。
   3. 如果不存在，引擎继续向上访问上级作用域，直到找到这个标识符为止。如果最终询问到全局作用域仍然未找到，则抛出一个异常（ReferenceError）。

总结：变量的赋值操作会执行两个动作，首先编译器会在当前作用域中声明一个变量(如果之前没有声明过)，然后在运行时引擎会在作用域中查找该变量，如果能够找到就会对它赋值。

### 接下来讲一下作用域嵌套：
```js
var b = 1;
function test() {
    console.log(b)
}
test();
```

当引擎执行到这一段代码时，会有以下几个步骤：
* 引擎询问test的作用域是否存在b标识符
* 结果在test的作用域中并不存在
* 引擎接着询问test的上一级作用域（这里是全局作用域）
* 结果找到了，开始使用b

### 总结下来，作用域就是一个集中管理变量，并且控制变量访问权限的枢纽。
